`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
//
// Read only memory used to store pre-computed twiddle factors.
//
// Supported sizes of N are 8, 512, and 1024. For final version only keep one of the sizes since the others cannot be used anyway.
//
// The factors were computed using the primitive_root.py script
//
//////////////////////////////////////////////////////////////////////////////////


module twiddle_rom#(
    parameter int N
  )(
    input logic mode, // 0: NTT, 1: Inverse NTT
    input logic [$clog2(N)-1:0] addr,
    output logic [14:0] data
  );

  // Forward NTT, primitive root: 4043
  (* rom_style = "block" *) reg [14:0] twiddle_ntt_8 [0:3] = {1, 4043, 1479, 7143};

  // Forward NTT, primitive root: 3
  (* rom_style = "block" *) reg [14:0] twiddle_ntt_512 [0:255] = {1, 3, 9, 27, 81, 243, 729, 2187, 6561, 7394, 9893, 5101, 3014, 9042, 2548, 7644, 10643, 7351, 9764, 4714, 1853, 5559, 4388, 875, 2625, 7875, 11336, 9430, 3712, 11136, 8830, 1912, 5736, 4919, 2468, 7404, 9923, 5191, 3284, 9852, 4978, 2645, 7935, 11516, 9970, 5332, 3707, 11121, 8785, 1777, 5331, 3704, 11112, 8758, 1696, 5088, 2975, 8925, 2197, 6591, 7484, 10163, 5911, 5444, 4043, 12129, 11809, 10849, 7969, 11618, 10276, 6250, 6461, 7094, 8993, 2401, 7203, 9320, 3382, 10146, 5860, 5291, 3584, 10752, 7678, 10745, 7657, 10682, 7468, 10115, 5767, 5012, 2747, 8241, 145, 435, 1305, 3915, 11745, 10657, 7393, 9890, 5092, 2987, 8961, 2305, 6915, 8456, 790, 2370, 7110, 9041, 2545, 7635, 10616, 7270, 9521, 3985, 11955, 11287, 9283, 3271, 9813, 4861, 2294, 6882, 8357, 493, 1479, 4437, 1022, 3066, 9198, 3016, 9048, 2566, 7698, 10805, 7837, 11222, 9088, 2686, 8058, 11885, 11077, 8653, 1381, 4143, 140, 420, 1260, 3780, 11340, 9442, 3748, 11244, 9154, 2884, 8652, 1378, 4134, 113, 339, 1017, 3051, 9153, 2881, 8643, 1351, 4053, 12159, 11899, 11119, 8779, 1759, 5277, 3542, 10626, 7300, 9611, 4255, 476, 1428, 4284, 563, 1689, 5067, 2912, 8736, 1630, 4890, 2381, 7143, 9140, 2842, 8526, 1000, 3000, 9000, 2422, 7266, 9509, 3949, 11847, 10963, 8311, 355, 1065, 3195, 9585, 4177, 242, 726, 2178, 6534, 7313, 9650, 4372, 827, 2481, 7443, 10040, 5542, 4337, 722, 2166, 6498, 7205, 9326, 3400, 10200, 6022, 5777, 5042, 2837, 8511, 955, 2865, 8595, 1207, 3621, 10863, 8011, 11744, 10654, 7384, 9863, 5011, 2744, 8232, 118, 354, 1062, 3186, 9558, 4096};

  // Forward NTT, primitive root: 49
  (* rom_style = "block" *) reg [14:0] twiddle_ntt_1024 [0:511] = {1, 49, 2401, 7048, 1260, 295, 2166, 7822, 2319, 3030, 1002, 12231, 9447, 8210, 9042, 654, 7468, 9551, 1017, 677, 8595, 3329, 3364, 5079, 3091, 3991, 11224, 9260, 11336, 2459, 9890, 5339, 3542, 1512, 354, 5057, 2013, 325, 3636, 6118, 4846, 3963, 9852, 3477, 10616, 4046, 1630, 6136, 5728, 10314, 1537, 1579, 3637, 6167, 7247, 11011, 11112, 3772, 493, 11868, 3949, 9166, 6730, 10256, 10984, 9789, 390, 6821, 2426, 8273, 12129, 4449, 9088, 2908, 7313, 1956, 9821, 1958, 9919, 6760, 11726, 9280, 27, 1323, 3382, 5961, 9442, 7965, 9326, 2281, 1168, 8076, 2476, 10723, 9289, 468, 10643, 5369, 5012, 12097, 2881, 5990, 10863, 3860, 4805, 1954, 9723, 9445, 8112, 4240, 11136, 4948, 8961, 8974, 9611, 3957, 9558, 1360, 5195, 8775, 12149, 5429, 7952, 8689, 7935, 7856, 3985, 10930, 7143, 5915, 7188, 8120, 4632, 5766, 12176, 6752, 11334, 2361, 5088, 3532, 1022, 922, 8311, 1702, 9664, 6554, 1632, 6234, 10530, 12121, 4057, 2169, 7969, 9522, 11885, 4782, 827, 3656, 7098, 3710, 9744, 10474, 9377, 4780, 729, 11143, 5291, 1190, 9154, 6142, 6022, 142, 6958, 9139, 5407, 6874, 5023, 347, 4714, 9784, 145, 7105, 4053, 1973, 10654, 5908, 6845, 3602, 4452, 9235, 10111, 3879, 5736, 10706, 8456, 8807, 1428, 8527, 12286, 12142, 5086, 3434, 8509, 11404, 5791, 1112, 5332, 3199, 9283, 174, 8526, 12237, 9741, 10327, 2174, 8214, 9238, 10258, 11082, 2302, 2197, 9341, 3016, 316, 3195, 9087, 2859, 4912, 7197, 8561, 1663, 7753, 11227, 9407, 6250, 11314, 1381, 6224, 10040, 400, 7311, 1858, 5019, 151, 7399, 6170, 7394, 5925, 7678, 7552, 1378, 6077, 2837, 3834, 3531, 973, 10810, 1263, 442, 9369, 4388, 6099, 3915, 7500, 11119, 4115, 5011, 12048, 480, 11231, 9603, 3565, 2639, 6421, 7404, 6415, 7110, 4298, 1689, 9027, 12208, 8320, 2143, 6695, 8541, 683, 8889, 5446, 8785, 350, 4861, 4698, 9000, 10885, 4938, 8471, 9542, 576, 3646, 6608, 4278, 709, 10163, 6427, 7698, 8532, 242, 11858, 3459, 9734, 9984, 9945, 8034, 418, 8193, 8209, 8993, 10542, 420, 8291, 722, 10800, 773, 1010, 334, 4077, 3149, 6833, 3014, 218, 10682, 7280, 339, 4322, 2865, 5206, 9314, 1693, 9223, 9523, 11934, 7183, 7875, 4916, 7393, 5876, 5277, 504, 118, 5782, 671, 8301, 1212, 10232, 9808, 1321, 3284, 1159, 7635, 5445, 8736, 10238, 10102, 3438, 8705, 8719, 9405, 6152, 6512, 11863, 3704, 9450, 8357, 3956, 9509, 11248, 10436, 7515, 11854, 3263, 130, 6370, 4905, 6854, 4043, 1483, 11222, 9162, 6534, 652, 7370, 4749, 11499, 10446, 8005, 11286, 9, 441, 9320, 1987, 11340, 2655, 7205, 8953, 8582, 2692, 9018, 11767, 11289, 156, 7644, 5886, 5767, 12225, 9153, 6093, 3621, 5383, 5698, 8844, 3241, 11341, 2704, 9606, 3712, 9842, 2987, 11184, 7300, 1319, 3186, 8646, 5828, 2925, 8146, 5906, 6747, 11089, 2645, 6715, 9521, 11836, 2381, 6068, 2396, 6803, 1544, 1922, 8155, 6347, 3778, 787, 1696, 9370, 4437, 8500, 10963, 8760, 11414, 6281, 544, 2078, 3510, 12233, 9545, 723, 10849, 3174, 8058, 1594, 4372, 5315, 2366, 5333, 3248, 11684, 7222, 9786, 243, 11907, 5860, 4493, 11244, 10240, 10200, 8240, 10512, 11239, 9995, 10484, 9867, 4212, 9764, 11454, 8241, 10561, 1351, 4754, 11744, 10162, 6378, 5297, 1484, 11271, 11563, 1293, 1912, 7665, 6915, 7032, 476, 11035};

  // Inverse NTT, primitive root: 5146
  (* rom_style = "block" *) reg [14:0] twiddle_intt_8 [0:3] = {1, 5146, 10810, 8246};

  // Inverse NTT, primitive root: 8193
  (* rom_style = "block" *) reg [14:0] twiddle_intt_512 [0:255] = {1, 8193, 2731, 9103, 11227, 11935, 12171, 4057, 9545, 7278, 2426, 4905, 1635, 545, 4278, 1426, 8668, 11082, 3694, 9424, 11334, 3778, 9452, 7247, 6512, 6267, 2089, 8889, 2963, 5084, 5791, 10123, 11567, 7952, 6747, 2249, 4846, 9808, 11462, 7917, 2639, 4976, 5755, 10111, 11563, 12047, 8112, 2704, 9094, 11224, 11934, 3978, 1326, 442, 8340, 2780, 5023, 9867, 3289, 9289, 11289, 3763, 9447, 3149, 5146, 9908, 7399, 10659, 3553, 9377, 7222, 10600, 11726, 8005, 10861, 11813, 8034, 2678, 4989, 1663, 8747, 7012, 10530, 3510, 1170, 390, 130, 8236, 10938, 3646, 9408, 3136, 9238, 11272, 11950, 12176, 8155, 10911, 3637, 9405, 3135, 1045, 8541, 2847, 949, 8509, 11029, 11869, 12149, 8146, 10908, 3636, 1212, 404, 4231, 9603, 3201, 1067, 4452, 1484, 4591, 9723, 3241, 9273, 3091, 9223, 11267, 7852, 10810, 11796, 3932, 5407, 9995, 7428, 2476, 9018, 3006, 1002, 334, 8304, 2768, 5019, 1673, 4654, 9744, 3248, 5179, 9919, 11499, 3833, 5374, 9984, 3328, 9302, 7197, 2399, 4896, 1632, 544, 8374, 10984, 11854, 12144, 4048, 9542, 7277, 6522, 2174, 4821, 1607, 4632, 1544, 4611, 1537, 8705, 6998, 6429, 2143, 8907, 2969, 5086, 9888, 3296, 5195, 5828, 6039, 2013, 671, 4320, 1440, 480, 160, 8246, 6845, 6378, 2126, 4805, 5698, 10092, 3364, 9314, 7201, 10593, 3531, 1177, 8585, 6958, 10512, 3504, 1168, 8582, 6957, 2319, 773, 4354, 9644, 7311, 2437, 9005, 7098, 2366, 4885, 9821, 7370, 6553, 10377, 3459, 1153, 8577, 2859, 953, 4414, 9664, 11414, 7901, 6730, 10436, 7575, 2525, 4938, 1646, 4645, 9741, 3247, 9275, 7188, 2396, 4895, 5728, 10102, 11560, 12046, 12208, 12262, 12280, 12286};

  // Inverse NTT, primitive root: 1254
  (* rom_style = "block" *) reg [14:0] twiddle_intt_1024 [0:511] = {1, 1254, 11813, 5257, 5374, 4624, 10377, 10996, 726, 1018, 10805, 6992, 5911, 2127, 545, 7535, 10938, 1728, 4048, 835, 2525, 8077, 2422, 1805, 2294, 1050, 1777, 4049, 2089, 2049, 1045, 7796, 6429, 382, 12046, 2503, 5067, 605, 9041, 6956, 9923, 6974, 7917, 10695, 4231, 9115, 1440, 11566, 2744, 56, 8779, 10211, 11745, 6008, 875, 3529, 1326, 3789, 7852, 2919, 10593, 11502, 8511, 5942, 4134, 10367, 10745, 5486, 9893, 6221, 9908, 453, 2768, 5574, 9644, 1200, 5542, 6383, 4143, 9364, 6461, 3643, 9103, 10970, 4989, 1105, 9302, 2447, 8577, 2683, 9585, 948, 9048, 3445, 6591, 6906, 8668, 6196, 3136, 64, 6522, 6403, 4645, 12133, 1000, 522, 3271, 9597, 3707, 3336, 5084, 9634, 949, 10302, 2969, 11848, 12280, 1003, 4284, 1843, 790, 7540, 4919, 11637, 5755, 3127, 1067, 10806, 8246, 5435, 7384, 5919, 12159, 9026, 435, 4774, 1853, 1041, 2780, 8333, 3932, 2839, 8585, 426, 5777, 6137, 2884, 3570, 3584, 8851, 2187, 2051, 3553, 6844, 4654, 11130, 9005, 10968, 2481, 2057, 11077, 3988, 11618, 6507, 12171, 11785, 7012, 6413, 4896, 7373, 4414, 5106, 355, 2766, 3066, 10596, 2975, 7083, 9424, 7967, 11950, 5009, 1607, 12071, 9275, 5456, 9140, 8212, 11955, 11279, 11516, 1489, 11567, 3998, 11869, 1747, 3296, 4080, 4096, 11871, 4255, 2344, 2305, 2555, 8830, 431, 12047, 3757, 4591, 5862, 2126, 11580, 8011, 5681, 8643, 11713, 2747, 3818, 7351, 1404, 3289, 7591, 7428, 11939, 3504, 6843, 3400, 11606, 3748, 5594, 10146, 3969, 81, 3262, 10600, 7991, 5179, 5874, 4885, 5868, 9650, 8724, 2686, 1058, 11809, 241, 7278, 8174, 1170, 4789, 8374, 6190, 7901, 2920, 11847, 11026, 1479, 11316, 8758, 8455, 9452, 6212, 10911, 4737, 4611, 6364, 4895, 6119, 4890, 12138, 7270, 10431, 4978, 11889, 2249, 6065, 10908, 975, 6039, 2882, 1062, 4536, 10626, 3728, 5092, 7377, 9430, 3202, 9094, 11973, 9273, 2948, 10092, 9987, 1207, 2031, 3051, 4075, 10115, 1962, 2548, 52, 3763, 12115, 3006, 9090, 6957, 11177, 6498, 885, 3780, 8855, 7203, 147, 3, 3762, 10861, 3482, 3833, 1583, 6553, 8410, 2178, 3054, 7837, 8687, 5444, 6381, 1635, 10316, 8236, 5184, 12144, 2505, 7575, 11942, 7266, 5415, 6882, 3150, 5331, 12147, 6267, 6147, 3135, 11099, 6998, 1146, 11560, 7509, 2912, 1815, 2545, 8579, 5191, 8633, 11462, 7507, 404, 2767, 4320, 10120, 8232, 168, 1759, 6055, 10657, 5735, 2625, 10587, 3978, 11367, 11267, 8757, 7201, 9928, 955, 5537, 113, 6523, 7657, 4169, 5101, 6374, 5146, 1359, 8304, 4433, 4354, 3600, 4337, 6860, 140, 3514, 7094, 10929, 2731, 8332, 2678, 3315, 3328, 7341, 1153, 8049, 4177, 2844, 2566, 10335, 7484, 8429, 1426, 6299, 9408, 192, 7277, 6920, 1646, 11821, 3000, 1566, 9813, 4213, 11121, 10008, 2963, 4324, 2847, 6328, 8907, 10966, 12262, 3009, 563, 5529, 2370, 10331, 2468, 10333, 4976, 9381, 3201, 7840, 160, 4016, 9863, 5468, 11899, 2500, 1305, 2033, 5559, 3123, 8340, 421, 11796, 8517, 1177, 1278, 5042, 6122, 8652, 10710, 10752, 1975, 6561, 6153, 10659, 8243, 1673, 8812, 2437, 8326, 7443, 6171, 8653, 11964, 10276, 7232, 11935, 10777, 8747, 6950, 2399, 9830, 953, 3029, 1065, 8298, 9198, 7210, 8925, 8960, 3694, 11612, 11272, 2738, 4821, 11635, 3247, 4079, 2842, 58, 11287, 9259, 9970, 4467, 10123, 11994, 11029, 5241, 9888, 12240};


  // Read data from ROM
  assign data =
         (mode == 0 && N == 8) ? twiddle_ntt_8[addr] :
         (mode == 0 && N == 512) ? twiddle_ntt_512[addr] :
         (mode == 0 && N == 1024) ? twiddle_ntt_1024[addr]:
         (mode == 1 && N == 8) ? twiddle_intt_8[addr] :
         (mode == 1 && N == 512) ? twiddle_intt_512[addr] :
         (mode == 1 && N == 1024) ? twiddle_intt_1024[addr]:
         0;

endmodule
