`timescale 1ns / 1ps

module ntt_negative_512_tb;

  logic clk;
  logic rst_n;

  logic mode;
  logic start;
  logic signed [14:0] input_polynomial[512];
  logic signed [14:0] output_polynomial[512];
  logic signed [14:0] expected_output_polynomial[512];
  logic done;

  ntt_negative #(
                 .N(512)
               )uut(
                 .clk(clk),
                 .rst_n(rst_n),
                 .mode(mode),
                 .start(start),
                 .input_polynomial(input_polynomial),
                 .done(done),
                 .output_polynomial(output_polynomial)
               );

  always #5 clk = ~clk;

  initial begin
    clk = 1;

    // Test 1: NTT of polynomial size 512
    rst_n = 0;
    #10;
    rst_n = 1;
    mode = 0;
    input_polynomial = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511};

    // Start NTT
    start = 1;
    #10;
    start = 0;

    // Wait for NTT to finish
    while (!done)
      #10;

    // Check output
    expected_output_polynomial = {3563,6312,914,1410,11670,3443,12179,10019,517,1596,4599,12059,2269,11382,7426,1130,246,10435,6449,299,1812,4928,12005,1256,5618,6703,7229,8046,8409,9999,3485,3908,8088,7095,8931,4210,10742,1391,12033,6888,10845,11474,3669,11279,1536,9546,8664,526,7131,972,5209,3222,4965,9341,7660,11592,10113,10612,9779,5716,7087,2728,10156,9673,2188,5184,413,1664,4718,11832,4207,11117,3116,6620,9465,3331,5582,3095,9217,9987,8073,832,11453,6766,4911,9219,10507,6306,3267,10701,4245,7238,4352,320,9126,9699,6384,2256,11657,3197,8966,7195,6343,9782,673,10393,11335,7383,2100,10387,7057,343,10741,6579,8973,1239,10562,3883,6143,9990,9572,6346,6050,76,6755,10825,3082,6983,5350,7948,7847,10678,1710,3253,1995,3120,2935,11778,2829,25,4509,11522,5213,1164,12172,7585,4010,4452,3504,7300,4992,10211,10931,10760,7215,6174,2156,4415,4856,1494,11727,606,5760,7340,5890,3864,152,3991,1009,10467,2762,7702,8942,4167,8794,10354,395,400,12033,6403,10161,8259,3337,7058,4704,976,1130,4295,7457,12247,3146,12118,2185,2315,1282,9736,5480,1856,8275,7214,803,7655,6805,10501,3883,517,9425,7414,10590,9221,11611,2226,7730,5299,2380,6630,10840,11522,3233,1815,4668,470,5278,99,9789,8865,1219,8020,4045,9786,9554,9646,3100,8216,7752,4197,6488,7443,973,11347,3678,1191,1617,10040,3597,8338,3826,7791,5447,4709,3229,8382,3421,5631,10708,11939,6129,8920,1131,3898,3491,8590,3003,4573,1938,6517,9116,8799,8244,6206,365,6723,8657,3644,11062,8479,9828,11980,358,10395,9394,9294,8305,3478,6662,5985,5560,3132,3294,4260,12266,8324,1222,2936,6024,4583,6173,6324,1261,11311,4052,10597,5436,1985,4970,10967,5014,6398,5370,8452,4710,12110,10504,11694,7160,7661,10528,9185,6793,8528,5583,4772,8083,7760,1698,9982,6634,12261,1083,1331,8591,4584,3451,621,8451,1812,6674,3166,6735,5522,2302,9304,5867,3880,7341,11250,5118,8941,4613,10319,8373,11294,11138,4506,6965,2760,922,3674,8997,2111,4625,9323,4636,2483,11972,7810,8697,11170,10672,12189,8806,6892,8860,11349,2003,10792,5550,5208,4549,3126,4171,7412,7128,10965,5063,4584,8348,9487,6958,10013,1734,2939,9743,1997,5443,10604,3391,2562,4459,5609,9476,5541,8926,11417,10839,11866,5724,1746,8722,8368,1825,6139,2520,796,108,5461,3127,5092,6433,2272,4957,8230,5750,583,66,4352,2221,6886,1973,8419,10731,3058,7852,3344,8762,4351,8103,5791,11749,4068,6319,1253,117,7230,7956,7939,12126,10206,11079,7563,4588,10690,4322,6576,3033,3865,2889,3751,7025,7611,6391,6172,10611,7941,11764,9654,5909,6316,7046,492,10679,1256,10805,2942,5448,953,5759,1373,7998,730,1904,4041,2549,2099,10519,7012,7732,10196,8031,5521,590,7304,9771,4816,10792,9827,8642,3430,8166,8118,5304,7964,4877,95,4303,4101,1620,9032,5499,7620,10736,0};
    if (output_polynomial === expected_output_polynomial)
      $display("Test 1: Passed");
    else
      $fatal(1, "Test 1: Failed. Expected: %p, Got: %p",expected_output_polynomial,output_polynomial);

    // Test 2: INTT of polynomial size 512
    rst_n = 0;
    #10;
    rst_n = 1;
    mode = 1;
    input_polynomial = {3563,6312,914,1410,11670,3443,12179,10019,517,1596,4599,12059,2269,11382,7426,1130,246,10435,6449,299,1812,4928,12005,1256,5618,6703,7229,8046,8409,9999,3485,3908,8088,7095,8931,4210,10742,1391,12033,6888,10845,11474,3669,11279,1536,9546,8664,526,7131,972,5209,3222,4965,9341,7660,11592,10113,10612,9779,5716,7087,2728,10156,9673,2188,5184,413,1664,4718,11832,4207,11117,3116,6620,9465,3331,5582,3095,9217,9987,8073,832,11453,6766,4911,9219,10507,6306,3267,10701,4245,7238,4352,320,9126,9699,6384,2256,11657,3197,8966,7195,6343,9782,673,10393,11335,7383,2100,10387,7057,343,10741,6579,8973,1239,10562,3883,6143,9990,9572,6346,6050,76,6755,10825,3082,6983,5350,7948,7847,10678,1710,3253,1995,3120,2935,11778,2829,25,4509,11522,5213,1164,12172,7585,4010,4452,3504,7300,4992,10211,10931,10760,7215,6174,2156,4415,4856,1494,11727,606,5760,7340,5890,3864,152,3991,1009,10467,2762,7702,8942,4167,8794,10354,395,400,12033,6403,10161,8259,3337,7058,4704,976,1130,4295,7457,12247,3146,12118,2185,2315,1282,9736,5480,1856,8275,7214,803,7655,6805,10501,3883,517,9425,7414,10590,9221,11611,2226,7730,5299,2380,6630,10840,11522,3233,1815,4668,470,5278,99,9789,8865,1219,8020,4045,9786,9554,9646,3100,8216,7752,4197,6488,7443,973,11347,3678,1191,1617,10040,3597,8338,3826,7791,5447,4709,3229,8382,3421,5631,10708,11939,6129,8920,1131,3898,3491,8590,3003,4573,1938,6517,9116,8799,8244,6206,365,6723,8657,3644,11062,8479,9828,11980,358,10395,9394,9294,8305,3478,6662,5985,5560,3132,3294,4260,12266,8324,1222,2936,6024,4583,6173,6324,1261,11311,4052,10597,5436,1985,4970,10967,5014,6398,5370,8452,4710,12110,10504,11694,7160,7661,10528,9185,6793,8528,5583,4772,8083,7760,1698,9982,6634,12261,1083,1331,8591,4584,3451,621,8451,1812,6674,3166,6735,5522,2302,9304,5867,3880,7341,11250,5118,8941,4613,10319,8373,11294,11138,4506,6965,2760,922,3674,8997,2111,4625,9323,4636,2483,11972,7810,8697,11170,10672,12189,8806,6892,8860,11349,2003,10792,5550,5208,4549,3126,4171,7412,7128,10965,5063,4584,8348,9487,6958,10013,1734,2939,9743,1997,5443,10604,3391,2562,4459,5609,9476,5541,8926,11417,10839,11866,5724,1746,8722,8368,1825,6139,2520,796,108,5461,3127,5092,6433,2272,4957,8230,5750,583,66,4352,2221,6886,1973,8419,10731,3058,7852,3344,8762,4351,8103,5791,11749,4068,6319,1253,117,7230,7956,7939,12126,10206,11079,7563,4588,10690,4322,6576,3033,3865,2889,3751,7025,7611,6391,6172,10611,7941,11764,9654,5909,6316,7046,492,10679,1256,10805,2942,5448,953,5759,1373,7998,730,1904,4041,2549,2099,10519,7012,7732,10196,8031,5521,590,7304,9771,4816,10792,9827,8642,3430,8166,8118,5304,7964,4877,95,4303,4101,1620,9032,5499,7620,10736,0};

    // Start INTT
    start = 1;
    #10;
    start = 0;

    // Wait for INTT to finish
    while (!done)
      #10;

    // Check output
    expected_output_polynomial = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511};
    if (output_polynomial === expected_output_polynomial)
      $display("Test 2: Passed");
    else
      $fatal(1, "Test 2: Failed. Expected: %p, Got: %p",expected_output_polynomial,output_polynomial);

    $display("All tests for ntt_negative_512 passed!");
    $finish;
  end

endmodule
